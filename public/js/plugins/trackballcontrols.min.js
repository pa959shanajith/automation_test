THREE.TrackballControls=function(e,t){function o(e){!1!==u.enabled&&(window.removeEventListener("keydown",o),g=l,l===E.NONE&&(e.keyCode!==u.keys[E.ROTATE]||u.noRotate?e.keyCode!==u.keys[E.ZOOM]||u.noZoom?e.keyCode!==u.keys[E.PAN]||u.noPan||(l=E.PAN):l=E.ZOOM:l=E.ROTATE))}function n(e){!1!==u.enabled&&(l=g,window.addEventListener("keydown",o,!1))}function s(e){!1!==u.enabled&&(e.preventDefault(),e.stopPropagation(),l===E.NONE&&(l=e.button),l!==E.ROTATE||u.noRotate?l!==E.ZOOM||u.noZoom?l!==E.PAN||u.noPan||(L.copy(A(e.pageX,e.pageY)),V.copy(L)):(b.copy(A(e.pageX,e.pageY)),O.copy(b)):(w.copy(D(e.pageX,e.pageY)),v.copy(w)),document.addEventListener("mousemove",c,!1),document.addEventListener("mouseup",i,!1),u.dispatchEvent(N))}function c(e){!1!==u.enabled&&(e.preventDefault(),e.stopPropagation(),l!==E.ROTATE||u.noRotate?l!==E.ZOOM||u.noZoom?l!==E.PAN||u.noPan||V.copy(A(e.pageX,e.pageY)):O.copy(A(e.pageX,e.pageY)):(v.copy(w),w.copy(D(e.pageX,e.pageY))))}function i(e){!1!==u.enabled&&(e.preventDefault(),e.stopPropagation(),l=E.NONE,document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",i),u.dispatchEvent(j))}function a(e){if(!1!==u.enabled){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:b.y-=.025*e.deltaY;break;case 1:b.y-=.01*e.deltaY;break;default:b.y-=25e-5*e.deltaY}u.dispatchEvent(N),u.dispatchEvent(j)}}function r(e){if(!1!==u.enabled){switch(e.touches.length){case 1:l=E.TOUCH_ROTATE,w.copy(D(e.touches[0].pageX,e.touches[0].pageY)),v.copy(w);break;default:l=E.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;H=R=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;L.copy(A(n,s)),V.copy(L)}u.dispatchEvent(N)}}function p(e){if(!1!==u.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:v.copy(w),w.copy(D(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;H=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;V.copy(A(n,s))}}function h(e){if(!1!==u.enabled){switch(e.touches.length){case 0:l=E.NONE;break;case 1:l=E.TOUCH_ROTATE,w.copy(D(e.touches[0].pageX,e.touches[0].pageY)),v.copy(w)}u.dispatchEvent(j)}}function d(e){!1!==u.enabled&&e.preventDefault()}var u=this,E={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var m=new THREE.Vector3,l=E.NONE,g=E.NONE,y=new THREE.Vector3,v=new THREE.Vector2,w=new THREE.Vector2,T=new THREE.Vector3,f=0,b=new THREE.Vector2,O=new THREE.Vector2,R=0,H=0,L=new THREE.Vector2,V=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var k={type:"change"},N={type:"start"},j={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var A=function(){var e=new THREE.Vector2;return function(t,o){return e.set((t-u.screen.left)/u.screen.width,(o-u.screen.top)/u.screen.height),e}}(),D=function(){var e=new THREE.Vector2;return function(t,o){return e.set((t-.5*u.screen.width-u.screen.left)/(.5*u.screen.width),(u.screen.height+2*(u.screen.top-o))/u.screen.width),e}}();this.rotateCamera=function(){var e,t=new THREE.Vector3,o=new THREE.Quaternion,n=new THREE.Vector3,s=new THREE.Vector3,c=new THREE.Vector3,i=new THREE.Vector3;return function(){i.set(w.x-v.x,w.y-v.y,0),(e=i.length())?(y.copy(u.object.position).sub(u.target),n.copy(y).normalize(),s.copy(u.object.up).normalize(),c.crossVectors(s,n).normalize(),s.setLength(w.y-v.y),c.setLength(w.x-v.x),i.copy(s.add(c)),t.crossVectors(i,y).normalize(),e*=u.rotateSpeed,o.setFromAxisAngle(t,e),y.applyQuaternion(o),u.object.up.applyQuaternion(o),T.copy(t),f=e):!u.staticMoving&&f&&(f*=Math.sqrt(1-u.dynamicDampingFactor),y.copy(u.object.position).sub(u.target),o.setFromAxisAngle(T,f),y.applyQuaternion(o),u.object.up.applyQuaternion(o)),v.copy(w)}}(),this.zoomCamera=function(){var e;l===E.TOUCH_ZOOM_PAN?(e=R/H,R=H,y.multiplyScalar(e)):(1!==(e=1+(O.y-b.y)*u.zoomSpeed)&&e>0&&y.multiplyScalar(e),u.staticMoving?b.copy(O):b.y+=(O.y-b.y)*this.dynamicDampingFactor)},this.panCamera=function(){var e=new THREE.Vector2,t=new THREE.Vector3,o=new THREE.Vector3;return function(){e.copy(V).sub(L),e.lengthSq()&&(e.multiplyScalar(y.length()*u.panSpeed),o.copy(y).cross(u.object.up).setLength(e.x),o.add(t.copy(u.object.up).setLength(e.y)),u.object.position.add(o),u.target.add(o),u.staticMoving?L.copy(V):L.add(e.subVectors(V,L).multiplyScalar(u.dynamicDampingFactor)))}}(),this.checkDistances=function(){u.noZoom&&u.noPan||(y.lengthSq()>u.maxDistance*u.maxDistance&&(u.object.position.addVectors(u.target,y.setLength(u.maxDistance)),b.copy(O)),y.lengthSq()<u.minDistance*u.minDistance&&(u.object.position.addVectors(u.target,y.setLength(u.minDistance)),b.copy(O)))},this.update=function(){y.subVectors(u.object.position,u.target),u.noRotate||u.rotateCamera(),u.noZoom||u.zoomCamera(),u.noPan||u.panCamera(),u.object.position.addVectors(u.target,y),u.checkDistances(),u.object.lookAt(u.target),m.distanceToSquared(u.object.position)>1e-6&&(u.dispatchEvent(k),m.copy(u.object.position))},this.reset=function(){l=E.NONE,g=E.NONE,u.target.copy(u.target0),u.object.position.copy(u.position0),u.object.up.copy(u.up0),y.subVectors(u.object.position,u.target),u.object.lookAt(u.target),u.dispatchEvent(k),m.copy(u.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",d,!1),this.domElement.removeEventListener("mousedown",s,!1),this.domElement.removeEventListener("wheel",a,!1),this.domElement.removeEventListener("touchstart",r,!1),this.domElement.removeEventListener("touchend",h,!1),this.domElement.removeEventListener("touchmove",p,!1),document.removeEventListener("mousemove",c,!1),document.removeEventListener("mouseup",i,!1),window.removeEventListener("keydown",o,!1),window.removeEventListener("keyup",n,!1)},this.domElement.addEventListener("contextmenu",d,!1),this.domElement.addEventListener("mousedown",s,!1),this.domElement.addEventListener("wheel",a,!1),this.domElement.addEventListener("touchstart",r,!1),this.domElement.addEventListener("touchend",h,!1),this.domElement.addEventListener("touchmove",p,!1),window.addEventListener("keydown",o,!1),window.addEventListener("keyup",n,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;