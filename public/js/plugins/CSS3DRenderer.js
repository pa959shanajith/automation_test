THREE.CSS3DObject=function(e){THREE.Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})},THREE.CSS3DObject.prototype=Object.create(THREE.Object3D.prototype),THREE.CSS3DObject.prototype.constructor=THREE.CSS3DObject,THREE.CSS3DSprite=function(e){THREE.CSS3DObject.call(this,e)},THREE.CSS3DSprite.prototype=Object.create(THREE.CSS3DObject.prototype),THREE.CSS3DSprite.prototype.constructor=THREE.CSS3DSprite,THREE.CSS3DRenderer=function(){function e(e){return Math.abs(e)<1e-10?0:e}function t(t){var r=t.elements;return"matrix3d("+e(r[0])+","+e(-r[1])+","+e(r[2])+","+e(r[3])+","+e(r[4])+","+e(-r[5])+","+e(r[6])+","+e(r[7])+","+e(r[8])+","+e(-r[9])+","+e(r[10])+","+e(r[11])+","+e(r[12])+","+e(-r[13])+","+e(r[14])+","+e(r[15])+")"}function r(t,r){var n=t.elements,o="matrix3d("+e(n[0])+","+e(n[1])+","+e(n[2])+","+e(n[3])+","+e(-n[4])+","+e(-n[5])+","+e(-n[6])+","+e(-n[7])+","+e(n[8])+","+e(n[9])+","+e(n[10])+","+e(n[11])+","+e(n[12])+","+e(n[13])+","+e(n[14])+","+e(n[15])+")";return E?"translate(-50%,-50%)translate("+i+"px,"+l+"px)"+r+o:"translate(-50%,-50%)"+o}function n(e,t,o){if(e instanceof THREE.CSS3DObject){var a;e instanceof THREE.CSS3DSprite?(c.copy(t.matrixWorldInverse),c.transpose(),c.copyPosition(e.matrixWorld),c.scale(e.scale),c.elements[3]=0,c.elements[7]=0,c.elements[11]=0,c.elements[15]=1,a=r(c,o)):a=r(e.matrixWorld,o);var s=e.element,i=d.objects[e.id]&&d.objects[e.id].style;void 0!==i&&i===a||(s.style.WebkitTransform=a,s.style.MozTransform=a,s.style.transform=a,d.objects[e.id]={style:a},E&&(d.objects[e.id].distanceToCameraSquared=S(t,e))),s.parentNode!==m&&m.appendChild(s)}for(var l=0,p=e.children.length;l<p;l++)n(e.children[l],t,o)}function o(e){var t=Object.keys(d.objects).sort(function(e,t){return d.objects[e].distanceToCameraSquared-d.objects[t].distanceToCameraSquared}),r=t.length;e.traverse(function(e){var n=t.indexOf(e.id+"");-1!==n&&(e.element.style.zIndex=r-n)})}var a,s,i,l,c=new THREE.Matrix4,d={camera:{fov:0,style:""},objects:{}},p=document.createElement("div");p.style.overflow="hidden",this.domElement=p;var m=document.createElement("div");m.style.WebkitTransformStyle="preserve-3d",m.style.MozTransformStyle="preserve-3d",m.style.transformStyle="preserve-3d",p.appendChild(m);var E=/Trident/i.test(navigator.userAgent);this.setClearColor=function(){},this.getSize=function(){return{width:a,height:s}},this.setSize=function(e,t){i=(a=e)/2,l=(s=t)/2,p.style.width=e+"px",p.style.height=t+"px",m.style.width=e+"px",m.style.height=t+"px"};var S=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r,n){return e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(n.matrixWorld),e.distanceToSquared(t)}}();this.render=function(e,r){var a=.5/Math.tan(THREE.Math.degToRad(.5*r.getEffectiveFOV()))*s;d.camera.fov!==a&&(p.style.WebkitPerspective=a+"px",p.style.MozPerspective=a+"px",p.style.perspective=a+"px",d.camera.fov=a),e.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld();var c="translateZ("+a+"px)"+t(r.matrixWorldInverse),S=c+"translate("+i+"px,"+l+"px)";d.camera.style===S||E||(m.style.WebkitTransform=S,m.style.MozTransform=S,m.style.transform=S,d.camera.style=S),n(e,r,c),E&&o(e)}};